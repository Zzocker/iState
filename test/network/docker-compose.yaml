version: "2"
networks:
  fabricnetwork: {}
services:
  ca.users.medisot.com:
    container_name: ca.users.medisot.com
    extends:
      file: base.yaml
      service: ca
    environment:
    - FABRIC_CA_SERVER_CA_NAME=MedisotUsersCA
    - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.users.medisot.com-cert.pem
    - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/9b31244338d7958bd47e65b339ce40effa1d138ccb35b3ba94c96a91b93fff93_sk
    - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.users.medisot.com-cert.pem
    - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/9b31244338d7958bd47e65b339ce40effa1d138ccb35b3ba94c96a91b93fff93_sk
    working_dir: /opt/ws
    volumes:
    - ./crypto-config/peerOrganizations/users.medisot.com/ca/:/etc/hyperledger/fabric-ca-server-config
    - ./:/opt/ws
    ports:
    - 50054:7054
    networks:
    - fabricnetwork
  cliuser:
    image: hyperledger/fabric-tools:${IMAGE_TAG}
    container_name: cliuser
    tty: true
    environment:
    - CORE_PEER_TLS_ENABLED=true
    - GOPATH=/opt/gopath
    - CORE_LOGGING_LEVEL=DEBUG
    - CORE_PEER_ID=cliuser
    - GODEBUG=netdns=go
    working_dir: /opt/ws
    volumes:
    - /var/run/:/host/var/run/
    - ./:/opt/ws
    - ../chaincode/:/opt/gopath/src/github.com/test
    depends_on:
    - orderer.users.medisot.com
    - peer0.users.medisot.com
    # - peer0.users.common.com
    networks:
    - fabricnetwork
  # couch0:
  #   container_name: couch0
  #   extends:
  #     file: base.yaml
  #     service: couchdb
  #   ports:
  #   - 5984:5984
  #   networks:
  #   - fabricnetwork
  # couch1:
  #   container_name: couch1
  #   extends:
  #     file: base.yaml
  #     service: couchdb
  #   ports:
  #   - 6984:5984
  #   networks:
  #   - fabricnetwork

  orderer.users.medisot.com:
    container_name: orderer.users.medisot.com
    extends:
      file: base.yaml
      service: orderer
    volumes:
    - ./genesis.block:/var/hyperledger/orderer/genesis.block
    - ./crypto-config/ordererOrganizations/users.medisot.com/orderers/orderer.users.medisot.com/msp:/var/hyperledger/orderer/msp
    - ./crypto-config/ordererOrganizations/users.medisot.com/orderers/orderer.users.medisot.com/tls/:/var/hyperledger/orderer/tls
    ports:
    - 50050:7050
    networks:
    - fabricnetwork
  peer0.users.medisot.com:
    container_name: peer0.users.medisot.com
    extends:
      file: base.yaml
      service: peer
    environment:
    - CORE_PEER_ID=peer0.users.medisot.com
    - CORE_PEER_ADDRESS=peer0.users.medisot.com:7051
    - CORE_PEER_CHAINCODELISTENADDRESS=peer0.users.medisot.com:7052
    - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.users.medisot.com:7051
    - CORE_PEER_LOCALMSPID=medisotUsersMSP
    # - CORE_LEDGER_STATE_STATEDATABASE=CouchDB
    # - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couch0:5984
    - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.users.medisot.com:7051
    volumes:
    - /mnt/ramdisk:/var/hyperledger
    - /var/run/:/host/var/run/
    - ./crypto-config/peerOrganizations/users.medisot.com/peers/peer0.users.medisot.com/msp:/etc/hyperledger/fabric/msp
    - ./crypto-config/peerOrganizations/users.medisot.com/peers/peer0.users.medisot.com/tls:/etc/hyperledger/fabric/tls
    ports:
    - 50051:7051
    - 50053:7053
    depends_on:
    # - couch4
    - orderer.users.medisot.com
    networks:
    - fabricnetwork
  # peer0.users.common.com:
  #   container_name: peer0.users.common.com
  #   extends:
  #     file: base.yaml
  #     service: peer
  #   environment:
  #   - CORE_PEER_ID=peer0.users.common.com
  #   - CORE_PEER_ADDRESS=peer0.users.common.com:7051
  #   - CORE_PEER_CHAINCODELISTENADDRESS=peer0.users.common.com:7052
  #   - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.users.common.com:7051
  #   - CORE_PEER_LOCALMSPID=commonUsersMSP
  #   # - CORE_LEDGER_STATE_STATEDATABASE=CouchDB
  #   # - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couch0:5984
  #   - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.users.common.com:7051
  #   volumes:
  #   - /var/run/:/host/var/run/
  #   - ./crypto-config/peerOrganizations/users.common.com/peers/peer0.users.common.com/msp:/etc/hyperledger/fabric/msp
  #   - ./crypto-config/peerOrganizations/users.common.com/peers/peer0.users.common.com/tls:/etc/hyperledger/fabric/tls
  #   ports:
  #   - 51051:7051
  #   - 51053:7053
  #   depends_on:
  #   # - couch0
  #   - orderer.users.medisot.com
  #   networks:
  #   - fabricnetwork
  